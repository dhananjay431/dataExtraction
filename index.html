<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI"
        crossorigin="anonymous"></script>

    <script src="https://code.jquery.com/jquery-4.0.0.slim.min.js"></script>
    <script src="./dist/bundle.js"></script>
    <script src="./src/lib/build/leader-line.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.17.21/lodash.min.js"></script>



    <style>
        #start,
        #end {
            width: 50px;
            height: 20px;
            background-color: red;
        }

        #dbPdf,
        #the-canvas {
            position: relative;
        }


        #db_curr {
            position: absolute;

            /* width: 5px;
            height: 5px;
            background-color: blue; */
        }
    </style>
</head>

<body>

    <div id="start">start</div>
    <div id="end">end</div>
    <div class="row">


        <div class="col-6">
            <input type="file" id="file">
        </div>
        <div class="col-6" id="cord">

        </div>

        <div class="col-8" id="dbPdf">

            <canvas id="the-canvas" class="img-fluid">

            </canvas>
            <div id="db_curr"></div>

        </div>
        <div class="col-4" id="list">


        </div>
    </div>
    <script>
        var line;
        var page = {};
        line = new LeaderLine(
            document.getElementById('start'),
            document.getElementById('end')
        );

        var arr = [];
        dbPDF.ev(document.getElementById("the-canvas"), 'click').subscribe((r) => {
            arr.push({ x: r.offsetX, y: r.offsetY });
            console.log(arr);
        })
        setTimeout(() => {

            dbPDF.ev(document.getElementById("list"), "mousemove").subscribe(r => {
                console.log("move=>", r.srcElement.id);


                let f = arrList.products.find(d => d.id == r.srcElement.id)
                console.log(f.cord);
                let db_curr = document.getElementById("db_curr");
                db_curr.style.position = "absolute";
                db_curr.style.left = f.cord[0] + f.cord[2] + "px";
                db_curr.style.top = f.cord[1] + "px";
                db_curr.style.width = f.cord[2] + "px";
                db_curr.style.height = f.cord[3] + "px";


                line.start = document.getElementById(f.id);
                line.end = db_curr;
                line.position();
                line.show();
            })
            // dbPDF.ev(document.getElementsByClassName("action"), "click").subscribe(r => {



            // })
        }, 2000)

        dbPDF.pp(
            dbPDF.ev(document.getElementById("file"), 'change'),
            dbPDF.mm(d => dbPDF.f(dbPDF.pdf({ pdfData: d.target.files[0], pageNumber: 1, scale: 1, id: "the-canvas" }))),
            dbPDF.t(d => {
                let canvas = document.getElementById('the-canvas');
                let context = canvas.getContext('2d');
                for (let i = 0; i < arrList.products.length; i++) {
                    context.lineWidth = 1;
                    context.fillStyle = '#e61b8412';
                    context.rect(...arrList.products[i].cord);
                    context.fill();
                }
            }),
            dbPDF.mm(x => dbPDF.ev(document.getElementById("the-canvas"), "mousemove"))
        )

            .subscribe(ev => {
                // 
                line.hide();
                for (let i = 0; i < arrList.products.length; i++) {
                    if (ev.offsetX >= arrList.products[i].cord[0] &&
                        ev.offsetX <= arrList.products[i].cord[0] + arrList.products[i].cord[2] &&
                        ev.offsetY >= arrList.products[i].cord[1] &&
                        ev.offsetY <= arrList.products[i].cord[1] + arrList.products[i].cord[3]
                    ) {
                        // const visible = dbPDF.isVisible(
                        //     document.getElementById(arrList.products[i].id),
                        //     document.getElementById('list')
                        // );
                        list.scrollTo({
                            top: document.getElementById(arrList.products[i].id).offsetTop - 94,
                            behavior: "smooth"
                        });
                        let dbCurr = document.getElementById("db_curr");
                        line.end = document.getElementById(arrList.products[i].id);
                        dbCurr.style.left = `${ev.offsetX}px`;
                        dbCurr.style.top = `${ev.offsetY}px`;

                        line.start = document.getElementById("db_curr");

                        line.position();
                        line.show();
                    }
                }
                // 
            })
        var arrList = {};
        function getData() {

            var cc = [
                [
                    {
                        "x": 469,
                        "y": 80
                    },
                    {
                        "x": 605,
                        "y": 78
                    },
                    {
                        "x": 445,
                        "y": 148
                    },
                    {
                        "x": 637,
                        "y": 158
                    }
                ],
                [
                    {
                        "x": 189,
                        "y": 182
                    },
                    {
                        "x": 887,
                        "y": 182
                    },
                    {
                        "x": 887,
                        "y": 210
                    },
                    {
                        "x": 182,
                        "y": 211
                    }
                ],
                [
                    {
                        "x": 184,
                        "y": 79
                    },
                    {
                        "x": 277,
                        "y": 79
                    },
                    {
                        "x": 269,
                        "y": 159
                    },
                    {
                        "x": 190,
                        "y": 162
                    }
                ],
                [
                    {
                        "x": 307,
                        "y": 87
                    },
                    {
                        "x": 398,
                        "y": 84
                    },
                    {
                        "x": 395,
                        "y": 154
                    },
                    {
                        "x": 301,
                        "y": 162
                    }
                ],
                [
                    {
                        "x": 423,
                        "y": 85
                    },
                    {
                        "x": 529,
                        "y": 90
                    },
                    {
                        "x": 522,
                        "y": 160
                    },
                    {
                        "x": 419,
                        "y": 161
                    }
                ],
                [
                    {
                        "x": 538,
                        "y": 81
                    },
                    {
                        "x": 669,
                        "y": 86
                    },
                    {
                        "x": 680,
                        "y": 168
                    },
                    {
                        "x": 543,
                        "y": 165
                    }
                ],
                [
                    {
                        "x": 707,
                        "y": 88
                    },
                    {
                        "x": 766,
                        "y": 86
                    },
                    {
                        "x": 774,
                        "y": 163
                    },
                    {
                        "x": 709,
                        "y": 168
                    }
                ],
                [
                    {
                        "x": 792,
                        "y": 74
                    },
                    {
                        "x": 875,
                        "y": 74
                    },
                    {
                        "x": 865,
                        "y": 160
                    },
                    {
                        "x": 806,
                        "y": 166
                    }
                ],
                [
                    {
                        "x": 42,
                        "y": 213
                    },
                    {
                        "x": 1054,
                        "y": 205
                    },
                    {
                        "x": 1030,
                        "y": 313
                    },
                    {
                        "x": 51,
                        "y": 310
                    }
                ],
                [
                    {
                        "x": 36,
                        "y": 230
                    },
                    {
                        "x": 157,
                        "y": 226
                    },
                    {
                        "x": 153,
                        "y": 278
                    },
                    {
                        "x": 36,
                        "y": 280
                    }
                ],
                [
                    {
                        "x": 36,
                        "y": 291
                    },
                    {
                        "x": 1034,
                        "y": 289
                    },
                    {
                        "x": 1043,
                        "y": 330
                    },
                    {
                        "x": 37,
                        "y": 334
                    }
                ],
                [
                    {
                        "x": 41,
                        "y": 161
                    },
                    {
                        "x": 156,
                        "y": 160
                    },
                    {
                        "x": 153,
                        "y": 213
                    },
                    {
                        "x": 27,
                        "y": 208
                    }
                ],
                [
                    {
                        "x": 32,
                        "y": 229
                    },
                    {
                        "x": 1039,
                        "y": 228
                    },
                    {
                        "x": 1041,
                        "y": 271
                    },
                    {
                        "x": 34,
                        "y": 267
                    }
                ],
                [
                    {
                        "x": 27,
                        "y": 99
                    },
                    {
                        "x": 162,
                        "y": 97
                    },
                    {
                        "x": 166,
                        "y": 155
                    },
                    {
                        "x": 32,
                        "y": 148
                    }
                ],
                [
                    {
                        "x": 34,
                        "y": 164
                    },
                    {
                        "x": 1034,
                        "y": 166
                    },
                    {
                        "x": 1057,
                        "y": 200
                    },
                    {
                        "x": 30,
                        "y": 204
                    }
                ],
                [
                    {
                        "x": 34,
                        "y": 32
                    },
                    {
                        "x": 180,
                        "y": 33
                    },
                    {
                        "x": 159,
                        "y": 79
                    },
                    {
                        "x": 28,
                        "y": 79
                    }
                ],
                [
                    {
                        "x": 27,
                        "y": 91
                    },
                    {
                        "x": 1044,
                        "y": 95
                    },
                    {
                        "x": 1056,
                        "y": 352
                    },
                    {
                        "x": 28,
                        "y": 355
                    }
                ],
                [
                    {
                        "x": 441,
                        "y": 318
                    },
                    {
                        "x": 1042,
                        "y": 315
                    },
                    {
                        "x": 1041,
                        "y": 475
                    },
                    {
                        "x": 442,
                        "y": 478
                    }
                ],
                [
                    {
                        "x": 20,
                        "y": 314
                    },
                    {
                        "x": 436,
                        "y": 318
                    },
                    {
                        "x": 419,
                        "y": 474
                    },
                    {
                        "x": 29,
                        "y": 481
                    }
                ],
                [
                    {
                        "x": 49,
                        "y": 279
                    },
                    {
                        "x": 322,
                        "y": 281
                    },
                    {
                        "x": 300,
                        "y": 317
                    },
                    {
                        "x": 47,
                        "y": 308
                    }
                ],
                [
                    {
                        "x": 53,
                        "y": 326
                    },
                    {
                        "x": 328,
                        "y": 323
                    },
                    {
                        "x": 329,
                        "y": 351
                    },
                    {
                        "x": 56,
                        "y": 358
                    }
                ],
                [
                    {
                        "x": 57,
                        "y": 385
                    },
                    {
                        "x": 313,
                        "y": 385
                    },
                    {
                        "x": 293,
                        "y": 408
                    },
                    {
                        "x": 58,
                        "y": 405
                    }
                ],
                [
                    {
                        "x": 60,
                        "y": 430
                    },
                    {
                        "x": 221,
                        "y": 431
                    },
                    {
                        "x": 194,
                        "y": 457
                    },
                    {
                        "x": 59,
                        "y": 458
                    }
                ],
                [
                    {
                        "x": 56,
                        "y": 485
                    },
                    {
                        "x": 211,
                        "y": 482
                    },
                    {
                        "x": 213,
                        "y": 506
                    },
                    {
                        "x": 60,
                        "y": 504
                    }
                ],
                [
                    {
                        "x": 57,
                        "y": 530
                    },
                    {
                        "x": 221,
                        "y": 531
                    },
                    {
                        "x": 225,
                        "y": 556
                    },
                    {
                        "x": 51,
                        "y": 560
                    }
                ],
                [
                    {
                        "x": 52,
                        "y": 312
                    },
                    {
                        "x": 148,
                        "y": 311
                    },
                    {
                        "x": 149,
                        "y": 338
                    },
                    {
                        "x": 48,
                        "y": 339
                    }
                ],
                [
                    {
                        "x": 53,
                        "y": 363
                    },
                    {
                        "x": 172,
                        "y": 359
                    },
                    {
                        "x": 168,
                        "y": 393
                    },
                    {
                        "x": 57,
                        "y": 395
                    }
                ],
                [
                    {
                        "x": 59,
                        "y": 415
                    },
                    {
                        "x": 223,
                        "y": 413
                    },
                    {
                        "x": 217,
                        "y": 445
                    },
                    {
                        "x": 57,
                        "y": 442
                    }
                ],
                [
                    {
                        "x": 57,
                        "y": 465
                    },
                    {
                        "x": 277,
                        "y": 460
                    },
                    {
                        "x": 289,
                        "y": 491
                    },
                    {
                        "x": 59,
                        "y": 485
                    }
                ],
                [
                    {
                        "x": 56,
                        "y": 512
                    },
                    {
                        "x": 131,
                        "y": 511
                    },
                    {
                        "x": 137,
                        "y": 537
                    },
                    {
                        "x": 53,
                        "y": 538
                    }
                ],
                [
                    {
                        "x": 61,
                        "y": 559
                    },
                    {
                        "x": 368,
                        "y": 560
                    },
                    {
                        "x": 369,
                        "y": 592
                    },
                    {
                        "x": 60,
                        "y": 593
                    }
                ],
                [
                    {
                        "x": 62,
                        "y": 545
                    },
                    {
                        "x": 306,
                        "y": 549
                    },
                    {
                        "x": 307,
                        "y": 577
                    },
                    {
                        "x": 61,
                        "y": 579
                    }
                ],
                [
                    {
                        "x": 59,
                        "y": 597
                    },
                    {
                        "x": 198,
                        "y": 600
                    },
                    {
                        "x": 195,
                        "y": 628
                    },
                    {
                        "x": 57,
                        "y": 624
                    }
                ],
                [
                    {
                        "x": 60,
                        "y": 652
                    },
                    {
                        "x": 308,
                        "y": 651
                    },
                    {
                        "x": 311,
                        "y": 674
                    },
                    {
                        "x": 62,
                        "y": 673
                    }
                ],
                [
                    {
                        "x": 59,
                        "y": 701
                    },
                    {
                        "x": 213,
                        "y": 701
                    },
                    {
                        "x": 217,
                        "y": 726
                    },
                    {
                        "x": 56,
                        "y": 724
                    }
                ],
                [
                    {
                        "x": 64,
                        "y": 554
                    },
                    {
                        "x": 313,
                        "y": 551
                    },
                    {
                        "x": 315,
                        "y": 581
                    },
                    {
                        "x": 57,
                        "y": 579
                    }
                ],
                [
                    {
                        "x": 62,
                        "y": 596
                    },
                    {
                        "x": 293,
                        "y": 601
                    },
                    {
                        "x": 286,
                        "y": 625
                    },
                    {
                        "x": 60,
                        "y": 629
                    }
                ]
            ];
            fetch("https://dummyjson.com/products").then(r => r.json()).then(r => {
                arrList = r;
                // 
                for (let i = 0; i < arrList.products.length; i++) {
                    arrList.products[i].cord = [i, (15 * i), 10, 10];

                }
                // 
                let list = document.getElementById("list")
                list.style.height = "200px"
                list.style.overflow = "scroll";

                let ul = document.createElement("ul");
                ul.innerHTML = r.products.map(d => {
                    return `<li id="${d.id}" class="action w-100">${d.title}</li>`;
                }).join("")
                list.appendChild(ul);

            })
        }
        getData();



    </script>
</body>

</html>