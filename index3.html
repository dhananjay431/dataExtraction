<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB"
      crossorigin="anonymous"
    />
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI"
      crossorigin="anonymous"
    ></script>

    <script src="https://code.jquery.com/jquery-4.0.0.slim.min.js"></script>
    <script src="./dist/bundle.js"></script>
    <script src="./src/lib/build/leader-line.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.17.21/lodash.min.js"></script>
    <script src="./data.js"></script>

    <style>
      #start,
      #end {
        width: 50px;
        height: 20px;
        background-color: red;
      }

      #dbPdf,
      #the-canvas {
        position: relative;
      }

      #db_curr {
        position: absolute;

        /* width: 5px;
            height: 5px;
            background-color: blue; */
      }
    </style>
  </head>

  <body>
    <div id="start">start</div>
    <div id="end">end</div>
    <div class="row">
      <div class="col-6"><input type="file" id="file" /></div>
      <div class="col-6" id="cord"></div>
      <div class="col-8" id="dbPdf">
        <canvas id="the-canvas" class="img-fluid"> </canvas>
        <div id="db_curr"></div>
      </div>
      <div class="col-4" id="list"></div>
    </div>
    <script>
      var line;
      var page = {};
      line = new LeaderLine(
        document.getElementById("start"),
        document.getElementById("end"),
      );

      var arr = [];

      dbPDF
        .pp(
          dbPDF.ev(document.getElementById("file"), "change"),
          dbPDF.mm((d) =>
            dbPDF.f(
              dbPDF.pdf({
                pdfData: d.target.files[0],
                pageNumber: 1,
                scale: 1,
                id: "the-canvas",
              }),
            ),
          ),
        )
        .subscribe((ev) => {
          //
          line.hide();
          let canvas = document.getElementById("the-canvas");
          let context = canvas.getContext("2d");
          let svg = dbPDF.createSvg(canvas.width, canvas.height);
          for (let i = 0; i < arrList.products.length; i++) {
            let polygon = dbPDF.createPolygon(
              arrList.products[i].cord.map((d) => d.x + "," + d.y).join(" "),
              "rgba(0,150,255,0.3)",
              "blue",
            ); 
            // pdf to list show array function start
            polygon.addEventListener("mouseenter", (ev) => {
              let db_curr = document.getElementById("db_curr");
              db_curr.style.position = "absolute";
              db_curr.style.left = ev.offsetX + "px";
              db_curr.style.top = ev.offsetY + "px";
              line.end = document.getElementById(arrList.products[i].id);
              line.start = db_curr;
              line.position();
              line.show();
            });
            polygon.addEventListener("mouseleave", (ev) => {
              line.show();
            });
            // pdf to list show array function end 
            svg.appendChild(polygon);
          }
          svg.style.position = "absolute";
          svg.style.top = "0px";
          svg.style.left = "0px";
          document.getElementById("dbPdf").appendChild(svg);
          //
        });
      var arrList = {};
      function getData() {
        fetch("https://dummyjson.com/products")
          .then((r) => r.json())
          .then((r) => {
            // list to pdf arrow show  function 
            //
            dbPDF
              .ev(document.getElementById("list"), "mousemove")
              .subscribe((r) => {
                let f = arrList.products.find((d) => d.id == r.srcElement.id);
                console.log(f.cord);
                let db_curr = document.getElementById("db_curr");
                db_curr.style.position = "absolute";
                db_curr.style.left = f.cord[2].x + "px";
                db_curr.style.top = f.cord[2].y + "px";
                line.start = document.getElementById(f.id);
                line.end = db_curr;
                line.position();
                line.show();
              });
            //
            arrList = r;
            for (let i = 0; i < arrList.products.length; i++) {
              arrList.products[i].cord = cc[i];
            }
            let list = document.getElementById("list");
            let ul = document.createElement("ul");
            ul.style.top = "0";
            ul.style.position = "sticky";
            ul.innerHTML = r.products
              .map((d) => {
                return `<li id="${d.id}" class="action w-100">${d.title}</li>`;
              })
              .join("");
            list.appendChild(ul);
          });
      }
      getData();
    </script>
  </body>
</html>
